
## Nmap Scans
Spot Nmap network scans on network traffic

| **Notes**                                                                                | **Wireshark Filters**                                                          |
| ---------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------ |
| Global search.                                                                           | - `tcp`<br><br>- `udp`                                                         |
| - Only SYN flag.<br>- SYN flag is set. The rest of the bits are not important.           | - `tcp.flags == 2`<br><br>- `tcp.flags.syn == 1`                               |
| - Only ACK flag.<br>- ACK flag is set. The rest of the bits are not important.           | - `tcp.flags == 16`<br><br>- `tcp.flags.ack == 1`                              |
| - Only SYN, ACK flags.<br>- SYN and ACK are set. The rest of the bits are not important. | - `tcp.flags == 18`<br><br>- `(tcp.flags.syn == 1) and (tcp.flags.ack == 1)`   |
| - Only RST flag.<br>- RST flag is set. The rest of the bits are not important.           | - `tcp.flags == 4`<br><br>- `tcp.flags.reset == 1`                             |
| - Only RST, ACK flags.<br>- RST and ACK are set. The rest of the bits are not important. | - `tcp.flags == 20`<br><br>- `(tcp.flags.reset == 1) and (tcp.flags.ack == 1)` |
| - Only FIN flag<br>- FIN flag is set. The rest of the bits are not important.            | - `tcp.flags == 1`<br><br>- `tcp.flags.fin == 1`                               |

Filter to find TCP Connect scan patterns in a capture file to easier locate tcp handshakes
`tcp.flags.syn==1 and tcp.flags.ack==0 and tcp.window_size > 1024`

Filter to find TCP SYN scan patterns in capture file
``tcp.flags.syn==1 and tcp.flags.ack==0 and tcp.window_size <= 1024`

Filter to find UDP scan patterns in a capture file
`icmp.type==3 and icmp.code==3`


## ARP Poisoning/Spoofing
Spot attempts to poison ARP tables for man-in-the-middle attacks. This often occurs when an ARP request receives multiple responses.

| **Notes**                                                                                                                                                                                                                                          | **Wireshark filter**                                                                                                                                                                                                                                   |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Global search                                                                                                                                                                                                                                      | - `arp`                                                                                                                                                                                                                                                |
| "ARP" options for grabbing the low-hanging fruits:<br><br>- Opcode 1: ARP requests.<br>- Opcode 2: ARP responses.<br>- **Hunt:** Arp scanning<br>- **Hunt:** Possible ARP poisoning detection<br>- **Hunt:** Possible ARP flooding from detection: | - `arp.opcode == 1`<br><br>- `arp.opcode == 2`<br><br>- `arp.dst.hw_mac==00:00:00:00:00:00`<br><br>- `arp.duplicate-address-detected or arp.duplicate-address-frame`<br><br>- `((arp) && (arp.opcode == 1)) && (arp.src.hw_mac == target-mac-address)` |

## Identifying Hosts with DHCP, NetBIOS, and Kerberos

### Filtering for DHCP
| **Notes**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | **Wireshark Filter**                                                                                                                                                                                                                    |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Global search.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | - `dhcp` or `bootp`                                                                                                                                                                                                                     |
| Filtering the proper DHCP packet options is vital to finding an event of interest.   <br>  <br><br>- **"DHCP Request"** packets contain the hostname information<br>- **"DHCP ACK"** packets represent the accepted requests<br>- **"DHCP NAK"** packets represent denied requests<br><br>Due to the nature of the protocol, only "Option 53" ( request type) has predefined static values. You should filter the packet type first, and then you can filter the rest of the options by "applying as column" or use the advanced filters like "contains" and "matches". | - Request: `dhcp.option.dhcp == 3`<br><br>- ACK: `dhcp.option.dhcp == 5`<br><br>- NAK: `dhcp.option.dhcp == 6`                                                                                                                          |
| **"DHCP Request"** options for grabbing the low-hanging fruits:<br><br>- **Option 12:** Hostname.<br>- **Option 50:** Requested IP address.<br>- **Option 51:** Requested IP lease time.<br>- **Option 61:** Client's MAC address.                                                                                                                                                                                                                                                                                                                                      | - `dhcp.option.hostname contains "keyword"`                                                                                                                                                                                             |
| **"DHCP ACK"** options for grabbing the low-hanging fruits:<br><br>- **Option 15:** Domain name.<br>- **Option 51:** Assigned IP lease time.                                                                                                                                                                                                                                                                                                                                                                                                                            | - `dhcp.option.domain_name contains "keyword"`                                                                                                                                                                                          |
| **"DHCP NAK"** options for grabbing the low-hanging fruits:<br><br>- **Option 56:** Message (rejection details/reason).                                                                                                                                                                                                                                                                                                                                                                                                                                                 | As the message could be unique according to the case/situation, It is suggested to read the message instead of filtering it. Thus, the analyst could create a more reliable hypothesis/result by understanding the event circumstances. |
